"use strict";angular.module("services").factory("TransitionEndService",["$window",function(){var a=null,b={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend"},c=document.createElement("div");for(var d in b)if(void 0!==c.style[d]){a=b[d];break}return a}]).factory("ProductService",["$resource",function(a){var b=a(globals.contextPath+"/json/product/:action.json",{},{getProductSizeData:{method:"GET",params:{action:"getProductData"}}});return{getProductSizeData:b.getProductSizeData}}]).factory("ProductsService",["$resource",function(a){var b=a(globals.contextPath+"/json/searchProductData/products.json",{},{getProducts:{method:"GET"}});return{getProducts:b.getProducts}}]).factory("SocialService",["$resource",function(a){var b={twitter:a("https://api.twitter.com/1/statuses/user_timeline.json",{callback:"JSON_CALLBACK",count:"5",include_rts:"1"},{getStatuses:{method:"JSONP",isArray:!0}})};return{getTwitter:b.twitter.getStatuses}}]).factory("ProductListService",["$rootScope","$http",function(a,b){function c(a){var b=["(cat,(Footwear),b)"];return _.each(a,function(a,c){a&&(_.isArray(a)?b=b.concat(d(a,c)):b.push(e(a,c)))}),"f:("+b.join()+")"}function d(a,b){if(!a.length)return[];var c=_.map(a,function(a){return a.value}).join();return"("+b+",("+c+"),u)"}function e(a,b){return"("+b+",("+a.value+"),u)"}function f(a){return"0-"+a.limit+"-"+a.by}return{getProducts:function(d,e){a.$broadcast("productList.loading"),b({method:"GET",url:globals.contextPath+"/json/searchProductData/shoes.json",params:{q:c(d),c:f(e)}}).then(function(b){a.$broadcast("productList.loaded",b.data)})}}}]).factory("QuickShopService",["$http",function(a){var b={contents:null};return{model:b,getProductData:function(c){var d=a.get(globals.contextPath+"/json/product/getLightweightProductData.json?productCode="+c).success(function(a){a.primaryImage&&(a.primaryImage.url=-1===a.primaryImage.url.indexOf("?")?a.primaryImage.url+"?time="+(new Date).getTime():a.primaryImage.url+"&time="+(new Date).getTime()),b.contents=a}).error(function(a){window.console&&window.console.log(a)});return d}}}]).factory("QuickShopPanelService",["QuickShopService","$rootScope",function(a,b){var c={left:0,top:0,width:0,setLeft:function(a){c.left=a},setTop:function(a){c.top=a},setWidth:function(a){c.width=a},getProductData:function(c){return b.$broadcast("quickShopLoading"),a.getProductData(c)}};return{panel:c}}]).factory("QuickBuyService",function(){var a={};return{model:a}}).factory("GTMService",function(){return{updateDataLayer:function(a){"undefined"!=typeof dataLayer&&dataLayer.push(a)}}}).factory("CartService",["$rootScope","$resource","$window","GTMService",function(a,b,c,d){var e=b(globals.contextPath+"/json/cart/:action.json",{_:(new Date).getTime()},{getCurrent:{method:"GET",params:{action:"getCurrent"}},updateLine:{method:"POST",params:{action:"updateLine"}},addCoupon:{method:"POST",params:{action:"addCoupon"}},removeCoupon:{method:"POST",params:{action:"removeCoupon"}},addItem:{method:"POST",params:{action:"addItem"}}}),f={contents:e.getCurrent(),inputs:{coupon:""},localMessages:{itemAdd:!1}},g=function(){Sportif.Nav.updateCartHeight()},h=function(){var a=[],b=[],c=[];_.each(f.contents.data.entries,function(d){a.push(d.product.code),b.push(d.basePrice.value),c.push(d.quantity)}),d.updateDataLayer({quantities:c.join("|")}),d.updateDataLayer({prices:b.join("|")}),d.updateDataLayer({event:"criteoBasket",productids:a.join("|")})},i=function(b){var c=b.messages;if(f.contents=b,f.localMessages.itemAdd=!1,f.localMessages.loading=!1,f.inputs.coupon="",g(),a.$broadcast("itemAddAttempted",b),d.updateDataLayer({event:"basketUpdated",cartTotal:f.contents.data.subTotal.value+f.contents.data.totalTax.value}),h(),c.coupons){var e="error"!==c.coupons.type;globals.googleAnalytics.trackEvent("Discount Code","Code Submitted",e.toString()),e&&(globals.mixpanel.people.set({"Affiliate-Promocode":f.coupon}),globals.mixpanel.register({"Affiliate-Promocode":f.coupon}))}},j=function(a,b,c){globals.googleAnalytics.trackEvent("Carts","AddToCart",a,b,!0),globals.googleAnalytics.trackEvent("Cart","AddToCart",a,c,!0)},k=function(a,b,c){globals.googleAnalytics.trackEvent("RemoveFromCarts","Number of Items",a,b,!0),globals.googleAnalytics.trackEvent("RemoveFromCart","Unit Price",a,c,!0)};return{model:f,updateLine:function(a,b,c,d){if(void 0!==b&&b!==c){var g=f.contents.data.entries[d].product.name,h=f.contents.data.entries[d].basePrice.value;b>c?j(g,b-c,h):k(g,c-b,h),e.updateLine({cartEntryNumber:a,quantity:b},i)}},addCoupon:function(a){$.trim(a).length&&(f.coupon=a,e.addCoupon({couponCode:a},i))},removeCoupon:function(a){e.removeCoupon({couponCode:a},i)},addItem:function(a,b){a?(f.localMessages.loading=!0,b=b?b:1,e.addItem({productCode:a,quantity:b},i)):f.localMessages.itemAdd=!0}}}]).factory("PostcodeAnywhereCaptureService",["$http",function(a){var b={find:function(b,c,d,e){c=null!=c?c:"";var f=Sportif.PostcodeAnywhere.findUrl.concat("?Key="+Sportif.PostcodeAnywhere.apiKey).concat("&SearchTerm="+b).concat("&LastId="+c).concat("&Country="+Sportif.PostcodeAnywhere.country).concat("&LanguagePreference="+Sportif.PostcodeAnywhere.language).concat("&$Top=500");a.jsonp(f+"&callback=JSON_CALLBACK").success(function(a){d&&d(a)}).error(function(a){e&&e(a)})},retrieve:function(b,c){var d=Sportif.PostcodeAnywhere.retrieveUrl.concat("?Key="+Sportif.PostcodeAnywhere.apiKey).concat("&Id="+b);a.jsonp(d+"&callback=JSON_CALLBACK").success(function(a){c&&c(a)}).error(function(a){error&&error(a)})}};return b}]).factory("MixPanelService",["$window",function(a){return{update:function(b){if(a.mixpanel){var c={},d=[],e=_.where(b.results.facets.primary,{active:!0}),f=_.where(b.results.facets.secondary,{active:!0}),g=_.map(_.where(e,{active:!0}),function(a){return a.values}),h=_.map(_.where(f,{active:!0}),function(a){return a.values}),i=g.concat(h);d=_.map(_.where(_.flatten(i),{active:!0}),function(a){return a.label}),d.length>0&&(c.facetdisplay=d.toString()),globals.mixpanel.track("Product Grid",c)}}}}]);